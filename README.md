# container-logs-to-metrics

## 構成
```
/home/c0a22166/teian
├── log_summary.py
```

## 実行する環境
- Python verion：3.12.3

## プログラムの概要

### `log_summary.py`
**説明**:このファイルをPythonで動かすことで、Elasticsearchのbeats indexにあるログをコンテナ名別に5分ごとに時間帯を分けて出力される。出力されるログはプログラム実行時の１時間前から現在時刻までのログである。
- 入力は，Elasticsearchのbeats indexのログである。出力はプログラム実行時の１時間前から現在時刻までのログである。
- 出力では、ログの時間帯、コンテナ名、ログ件数、5分前のログ件数からの変化を出力する。
**使い方**:
```
(venv) c0a22166@c0a22166:~/teian$ python3 log_summary.py
✅ ログ検索期間: 2025-07-11 00:40:42 から 2025-07-11 01:40:42
✅ Elasticsearch (192.168.100.71:30092, Index: beats-*) からログを取得中...
✅ 570673 件のログを取得しました。
✅ 集計が完了しました → log_summary.csv
(venv) c0a22166@c0a22166:~/teian$ 
```
- **実行結果**
```
時間帯,コンテナ名,ログ件数,前時間帯からの変化
2025-07-11 00:40,author-app-container,497,-
2025-07-11 00:40,author-mongo-container,7,-
2025-07-11 00:40,builder,109,-
2025-07-11 00:40,cadvisor,2,-
2025-07-11 00:40,ceph-exporter,408,-
2025-07-11 00:40,coredns,50,-
2025-07-11 00:40,csi-snapshotter,88,-
2025-07-11 00:40,discovery,30,-
2025-07-11 00:40,filebeat,1835,-
2025-07-11 00:40,front-app-container,1284,-
2025-07-11 00:40,fulltext-app-container,24,-
2025-07-11 00:40,istio-proxy,2273,-
2025-07-11 00:40,kea,90,-
2025-07-11 00:40,log-collector,53,-
2025-07-11 00:40,metrics,103,-
2025-07-11 00:40,mgr,504,-
2025-07-11 00:40,mon,3702,-
2025-07-11 00:40,my-redmine,215,-
2025-07-11 00:40,osd,325,-
2025-07-11 00:40,paper-app-container,236,-
2025-07-11 00:40,paper-mongo-container,8,-
2025-07-11 00:40,prometheus,25,-
2025-07-11 00:40,stats-app-container,19032,-
2025-07-11 00:40,stns-server,271,-
2025-07-11 00:40,vmware-exporter,7216,-
2025-07-11 00:40,watch-active,203,-
2025-07-11 00:45,author-app-container,565,+68
2025-07-11 00:45,author-mongo-container,5,-2
2025-07-11 00:45,builder,128,+19
2025-07-11 00:45,cadvisor,2,+0
2025-07-11 00:45,ceph-exporter,478,+70
2025-07-11 00:45,coredns,58,+8
2025-07-11 00:45,csi-resizer,2,-
2025-07-11 00:45,csi-snapshotter,106,+18
2025-07-11 00:45,discovery,20,-10
2025-07-11 00:45,filebeat,2127,+292
2025-07-11 00:45,front-app-container,1444,+160
2025-07-11 00:45,fulltext-app-container,382,+358
2025-07-11 00:45,grafana,4,-
2025-07-11 00:45,istio-proxy,2640,+367
2025-07-11 00:45,kea,95,+5
2025-07-11 00:45,log-collector,110,+57
2025-07-11 00:45,metrics,119,+16
2025-07-11 00:45,mgr,603,+99
2025-07-11 00:45,mon,4604,+902
2025-07-11 00:45,my-redmine,250,+35
2025-07-11 00:45,osd,13,-312
2025-07-11 00:45,paper-app-container,272,+36
2025-07-11 00:45,paper-mongo-container,5,-3
2025-07-11 00:45,powerdns-helm,1,-
2025-07-11 00:45,prometheus,30,+5
2025-07-11 00:45,stats-app-container,22234,+3202
2025-07-11 00:45,stns-server,317,+46
2025-07-11 00:45,vmware-exporter,8459,+1243
2025-07-11 00:45,watch-active,232,+29
2025-07-11 00:50,author-app-container,589,+24
2025-07-11 00:50,author-mongo-container,5,+0
2025-07-11 00:50,builder,128,+0
2025-07-11 00:50,cadvisor,2,+0
2025-07-11 00:50,ceph-exporter,479,+1
2025-07-11 00:50,coredns,60,+2
2025-07-11 00:50,csi-snapshotter,110,+4
2025-07-11 00:50,discovery,30,+10
2025-07-11 00:50,filebeat,2189,+62
2025-07-11 00:50,front-app-container,1291,-153
2025-07-11 00:50,fulltext-app-container,24,-358
2025-07-11 00:50,istio-proxy,2642,+2
2025-07-11 00:50,kea,103,+8
2025-07-11 00:50,log-collector,239,+129
2025-07-11 00:50,metrics,119,+0
2025-07-11 00:50,mgr,602,-1
2025-07-11 00:50,mon,4568,-36
2025-07-11 00:50,my-redmine,250,+0
2025-07-11 00:50,osd,267,+254
2025-07-11 00:50,paper-app-container,274,+2
2025-07-11 00:50,paper-mongo-container,5,+0
2025-07-11 00:50,prometheus,30,+0
2025-07-11 00:50,stats-app-container,22048,-186
2025-07-11 00:50,stns-server,316,-1
2025-07-11 00:50,vmware-exporter,8462,+3
2025-07-11 00:50,watch-active,233,+1
2025-07-11 00:55,author-app-container,541,-48
2025-07-11 00:55,author-mongo-container,5,+0
2025-07-11 00:55,builder,126,-2
2025-07-11 00:55,cadvisor,2,+0
2025-07-11 00:55,ceph-exporter,478,-1
2025-07-11 00:55,coredns,62,+2
2025-07-11 00:55,csi-resizer,2,+0
2025-07-11 00:55,csi-snapshotter,110,+0
2025-07-11 00:55,discovery,8,-22
2025-07-11 00:55,filebeat,2098,-91
2025-07-11 00:55,front-app-container,1443,+152
2025-07-11 00:55,fulltext-app-container,395,+371
2025-07-11 00:55,grafana,2,-2
2025-07-11 00:55,istio-proxy,2637,-5
2025-07-11 00:55,jumpsv,5,-
2025-07-11 00:55,kea,96,-7
2025-07-11 00:55,log-collector,53,-186
2025-07-11 00:55,metrics,118,-1
2025-07-11 00:55,mgr,602,+0
2025-07-11 00:55,mon,4493,-75
2025-07-11 00:55,my-redmine,250,+0
2025-07-11 00:55,osd,15,-252
2025-07-11 00:55,paper-app-container,265,-9
2025-07-11 00:55,paper-mongo-container,5,+0
2025-07-11 00:55,prometheus,30,+0
2025-07-11 00:55,stats-app-container,22118,+70
2025-07-11 00:55,stns-server,342,+26
2025-07-11 00:55,vmware-exporter,8458,-4
2025-07-11 00:55,watch-active,234,+1
2025-07-11 01:00,author-app-container,561,+20
2025-07-11 01:00,author-mongo-container,5,+0
2025-07-11 01:00,builder,126,+0
2025-07-11 01:00,cadvisor,2,+0
2025-07-11 01:00,ceph-exporter,476,-2
2025-07-11 01:00,coredns,56,-6
2025-07-11 01:00,csi-snapshotter,106,-4
2025-07-11 01:00,discovery,20,+12
2025-07-11 01:00,filebeat,2181,+83
2025-07-11 01:00,front-app-container,1296,-147
2025-07-11 01:00,fulltext-app-container,393,-2
2025-07-11 01:00,grafana,6,+4
2025-07-11 01:00,istio-proxy,2640,+3
2025-07-11 01:00,kea,100,+4
2025-07-11 01:00,log-collector,110,+57
2025-07-11 01:00,metrics,118,+0
2025-07-11 01:00,mgr,600,-2
2025-07-11 01:00,mon,4710,+217
2025-07-11 01:00,my-redmine,250,+0
2025-07-11 01:00,osd,118,+103
2025-07-11 01:00,paper-app-container,277,+12
2025-07-11 01:00,paper-mongo-container,6,+1
2025-07-11 01:00,prometheus,32,+2
2025-07-11 01:00,stats-app-container,22117,-1
2025-07-11 01:00,stns-server,316,-26
2025-07-11 01:00,vmware-exporter,8461,+3
2025-07-11 01:00,watch-active,228,-6
2025-07-11 01:05,author-app-container,560,-1
2025-07-11 01:05,author-mongo-container,5,+0
2025-07-11 01:05,builder,127,+1
2025-07-11 01:05,cadvisor,2,+0
2025-07-11 01:05,ceph-exporter,479,+3
2025-07-11 01:05,coredns,60,+4
2025-07-11 01:05,csi-resizer,2,+0
2025-07-11 01:05,csi-snapshotter,112,+6
2025-07-11 01:05,discovery,44,+24
2025-07-11 01:05,filebeat,2153,-28
2025-07-11 01:05,front-app-container,1443,+147
2025-07-11 01:05,fulltext-app-container,277,-116
2025-07-11 01:05,grafana,2,-4
2025-07-11 01:05,istio-proxy,2652,+12
2025-07-11 01:05,kea,99,-1
2025-07-11 01:05,log-collector,239,+129
2025-07-11 01:05,metrics,119,+1
2025-07-11 01:05,mgr,604,+4
2025-07-11 01:05,mon,4476,-234
2025-07-11 01:05,my-redmine,250,+0
2025-07-11 01:05,osd,11,-107
2025-07-11 01:05,paper-app-container,269,-8
2025-07-11 01:05,paper-mongo-container,5,-1
2025-07-11 01:05,prometheus,30,-2
2025-07-11 01:05,stats-app-container,21886,-231
2025-07-11 01:05,stns-server,317,+1
2025-07-11 01:05,vmware-exporter,8460,-1
2025-07-11 01:05,watch-active,235,+7
2025-07-11 01:10,author-app-container,552,-8
2025-07-11 01:10,author-mongo-container,5,+0
2025-07-11 01:10,builder,127,+0
2025-07-11 01:10,cadvisor,2,+0
2025-07-11 01:10,ceph-exporter,479,+0
2025-07-11 01:10,coredns,58,-2
2025-07-11 01:10,csi-snapshotter,102,-10
2025-07-11 01:10,discovery,38,-6
2025-07-11 01:10,filebeat,2118,-35
2025-07-11 01:10,front-app-container,1442,-1
2025-07-11 01:10,fulltext-app-container,143,-134
2025-07-11 01:10,istio-proxy,2622,-30
2025-07-11 01:10,kea,93,-6
2025-07-11 01:10,log-collector,53,-186
2025-07-11 01:10,metrics,119,+0
2025-07-11 01:10,mgr,601,-3
2025-07-11 01:10,mon,4698,+222
2025-07-11 01:10,my-redmine,250,+0
2025-07-11 01:10,osd,641,+630
2025-07-11 01:10,paper-app-container,270,+1
2025-07-11 01:10,paper-mongo-container,5,+0
2025-07-11 01:10,prometheus,30,+0
2025-07-11 01:10,recu-pdns-recursor-helm,6,-
2025-07-11 01:10,stats-app-container,22120,+234
2025-07-11 01:10,stns-server,316,-1
2025-07-11 01:10,vmware-exporter,8464,+4
2025-07-11 01:10,watch-active,230,-5
2025-07-11 01:15,author-app-container,543,-9
2025-07-11 01:15,author-mongo-container,5,+0
2025-07-11 01:15,builder,130,+3
2025-07-11 01:15,cadvisor,2,+0
2025-07-11 01:15,ceph-exporter,477,-2
2025-07-11 01:15,coredns,58,+0
2025-07-11 01:15,csi-resizer,2,+0
2025-07-11 01:15,csi-snapshotter,110,+8
2025-07-11 01:15,ddns,21,-
2025-07-11 01:15,discovery,20,-18
2025-07-11 01:15,filebeat,2158,+40
2025-07-11 01:15,front-app-container,1445,+3
2025-07-11 01:15,fulltext-app-container,392,+249
2025-07-11 01:15,grafana,4,+2
2025-07-11 01:15,istio-proxy,2641,+19
2025-07-11 01:15,jumpsv,5,+0
2025-07-11 01:15,kea,103,+10
2025-07-11 01:15,log-collector,110,+57
2025-07-11 01:15,metrics,119,+0
2025-07-11 01:15,mgr,603,+2
2025-07-11 01:15,mon,4483,-215
2025-07-11 01:15,my-redmine,250,+0
2025-07-11 01:15,osd,381,-260
2025-07-11 01:15,paper-app-container,274,+4
2025-07-11 01:15,paper-mongo-container,5,+0
2025-07-11 01:15,powerdns-helm,1,+0
2025-07-11 01:15,prometheus,30,+0
2025-07-11 01:15,stats-app-container,22115,-5
2025-07-11 01:15,stns-server,353,+37
2025-07-11 01:15,vmware-exporter,8460,-4
2025-07-11 01:15,watch-active,237,+7
2025-07-11 01:20,author-app-container,574,+31
2025-07-11 01:20,author-mongo-container,5,+0
2025-07-11 01:20,builder,128,-2
2025-07-11 01:20,cadvisor,2,+0
2025-07-11 01:20,ceph-exporter,477,+0
2025-07-11 01:20,coredns,58,+0
2025-07-11 01:20,csi-snapshotter,114,+4
2025-07-11 01:20,discovery,24,+4
2025-07-11 01:20,filebeat,2139,-19
2025-07-11 01:20,front-app-container,1443,-2
2025-07-11 01:20,fulltext-app-container,24,-368
2025-07-11 01:20,istio-proxy,2639,-2
2025-07-11 01:20,kea,96,-7
2025-07-11 01:20,log-collector,239,+129
2025-07-11 01:20,metrics,117,-2
2025-07-11 01:20,mgr,602,-1
2025-07-11 01:20,mon,4439,-44
2025-07-11 01:20,my-redmine,265,+15
2025-07-11 01:20,osd,683,+302
2025-07-11 01:20,paper-app-container,265,-9
2025-07-11 01:20,paper-mongo-container,5,+0
2025-07-11 01:20,prometheus,30,+0
2025-07-11 01:20,redmine-ticket-receiver,1,-
2025-07-11 01:20,stats-app-container,22118,+3
2025-07-11 01:20,stns-server,326,-27
2025-07-11 01:20,vmware-exporter,8456,-4
2025-07-11 01:20,watch-active,228,-9
2025-07-11 01:25,author-app-container,571,-3
2025-07-11 01:25,author-mongo-container,5,+0
2025-07-11 01:25,builder,127,-1
2025-07-11 01:25,cadvisor,2,+0
2025-07-11 01:25,ceph-exporter,478,+1
2025-07-11 01:25,coredns,60,+2
2025-07-11 01:25,csi-resizer,2,+0
2025-07-11 01:25,csi-snapshotter,104,-10
2025-07-11 01:25,discovery,2,-22
2025-07-11 01:25,filebeat,2051,-88
2025-07-11 01:25,front-app-container,1446,+3
2025-07-11 01:25,fulltext-app-container,382,+358
2025-07-11 01:25,grafana,2,-2
2025-07-11 01:25,istio-proxy,2631,-8
2025-07-11 01:25,jumpsv,10,+5
2025-07-11 01:25,kea,98,+2
2025-07-11 01:25,log-collector,53,-186
2025-07-11 01:25,metrics,116,-1
2025-07-11 01:25,mgr,602,+0
2025-07-11 01:25,mon,4733,+294
2025-07-11 01:25,my-redmine,250,-15
2025-07-11 01:25,osd,13,-670
2025-07-11 01:25,paper-app-container,275,+10
2025-07-11 01:25,paper-mongo-container,5,+0
2025-07-11 01:25,prometheus,30,+0
2025-07-11 01:25,recu-pdns-recursor-helm,1,-5
2025-07-11 01:25,stats-app-container,22050,-68
2025-07-11 01:25,stns-server,389,+63
2025-07-11 01:25,vmware-exporter,8459,+3
2025-07-11 01:25,watch-active,237,+9
2025-07-11 01:30,author-app-container,594,+23
2025-07-11 01:30,author-mongo-container,5,+0
2025-07-11 01:30,builder,127,+0
2025-07-11 01:30,cadvisor,2,+0
2025-07-11 01:30,ceph-exporter,478,+0
2025-07-11 01:30,cert-manager-webhook,2,-
2025-07-11 01:30,coredns,60,+0
2025-07-11 01:30,csi-snapshotter,100,-4
2025-07-11 01:30,discovery,30,+28
2025-07-11 01:30,filebeat,2195,+144
2025-07-11 01:30,front-app-container,1442,-4
2025-07-11 01:30,fulltext-app-container,26,-356
2025-07-11 01:30,grafana,1,-1
2025-07-11 01:30,istio-proxy,2641,+10
2025-07-11 01:30,jumpsv,11,+1
2025-07-11 01:30,kea,95,-3
2025-07-11 01:30,log-collector,110,+57
2025-07-11 01:30,metrics,119,+3
2025-07-11 01:30,mgr,601,-1
2025-07-11 01:30,mon,4309,-424
2025-07-11 01:30,my-redmine,250,+0
2025-07-11 01:30,osd,586,+573
2025-07-11 01:30,paper-app-container,269,-6
2025-07-11 01:30,paper-mongo-container,5,+0
2025-07-11 01:30,prometheus,30,+0
2025-07-11 01:30,stats-app-container,21886,-164
2025-07-11 01:30,stns-server,352,-37
2025-07-11 01:30,vmware-exporter,8466,+7
2025-07-11 01:30,watch-active,228,-9
2025-07-11 01:35,author-app-container,539,-55
2025-07-11 01:35,author-mongo-container,5,+0
2025-07-11 01:35,builder,128,+1
2025-07-11 01:35,cadvisor,2,+0
2025-07-11 01:35,ceph-exporter,478,+0
2025-07-11 01:35,coredns,58,-2
2025-07-11 01:35,csi-resizer,2,+0
2025-07-11 01:35,csi-snapshotter,108,+8
2025-07-11 01:35,ddns,10,-11
2025-07-11 01:35,discovery,20,-10
2025-07-11 01:35,filebeat,2134,-61
2025-07-11 01:35,front-app-container,1442,+0
2025-07-11 01:35,fulltext-app-container,380,+354
2025-07-11 01:35,grafana,2,+1
2025-07-11 01:35,istio-proxy,2631,-10
2025-07-11 01:35,jumpsv,2,-9
2025-07-11 01:35,kea,97,+2
2025-07-11 01:35,log-collector,239,+129
2025-07-11 01:35,metrics,119,+0
2025-07-11 01:35,mgr,604,+3
2025-07-11 01:35,mon,4748,+439
2025-07-11 01:35,my-redmine,250,+0
2025-07-11 01:35,osd,13,-573
2025-07-11 01:35,paper-app-container,271,+2
2025-07-11 01:35,paper-mongo-container,5,+0
2025-07-11 01:35,prometheus,30,+0
2025-07-11 01:35,redmine-ticket-receiver,1,+0
2025-07-11 01:35,stats-app-container,22120,+234
2025-07-11 01:35,stns-server,319,-33
2025-07-11 01:35,vmware-exporter,8460,-6
2025-07-11 01:35,watch-active,235,+7
2025-07-11 01:40,author-app-container,83,-456
2025-07-11 01:40,author-mongo-container,1,-4
2025-07-11 01:40,builder,18,-110
2025-07-11 01:40,ceph-exporter,65,-413
2025-07-11 01:40,coredns,8,-50
2025-07-11 01:40,csi-snapshotter,14,-94
2025-07-11 01:40,discovery,6,-14
2025-07-11 01:40,filebeat,498,-1636
2025-07-11 01:40,front-app-container,163,-1279
2025-07-11 01:40,istio-proxy,378,-2253
2025-07-11 01:40,kea,15,-82
2025-07-11 01:40,metrics,14,-105
2025-07-11 01:40,mgr,95,-509
2025-07-11 01:40,mon,594,-4154
2025-07-11 01:40,my-redmine,35,-215
2025-07-11 01:40,osd,78,+65
2025-07-11 01:40,paper-app-container,38,-233
2025-07-11 01:40,paper-mongo-container,1,-4
2025-07-11 01:40,prometheus,5,-25
2025-07-11 01:40,recu-pdns-recursor-helm,6,+5
2025-07-11 01:40,stats-app-container,3193,-18927
2025-07-11 01:40,stns-server,46,-273
2025-07-11 01:40,vmware-exporter,1173,-7287
2025-07-11 01:40,watch-active,32,-203
```
